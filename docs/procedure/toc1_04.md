# 2.4 標準製品仕様書の拡張

## 2.4 標準製品仕様書の拡張

3D都市モデルのユースケースに必要な地物等が標準製品仕様書に定義されておらず、地物型等の追加が必要な場合は、標準製品仕様書を拡張する。拡張のパターン（2.4.1）により、拡張の手順（2.4.2）が異なる。

## 2.4.1 製品仕様の拡張パターン

追加したい地物型等の拡張パターンを表2-9に示す。

**表 2-9 — 標準製品仕様書の拡張パターン**

| 拡張パターン | ← | ← | 例 | 手順書の箇条 |
| --- | --- | --- | --- | --- |
| a属性又は関連役割を追加する | a-1 | コード型の地物属性を追加する | 建築物に属性として「新築区分」を追加する | 2.4.2.1 |
| ↑ | a-2 | コード型以外の地物属性または地物関連を追加する | 建築物に属性として「建物1階面積」を追加する | 2.4.2.2 |
| b標準製品仕様書に定義されていない地物型等を追加する | b-1 | i-URに存在する地物型等を追加する | 地物型として「都市再生緊急整備地域」を追加する | 2.4.2.3 |
| ↑ | b-2 | i-URやCityGMLに存在しない地物型を追加する | 地物型として「通学区域」を追加する | 2.4.2.4 |

i-UR及びCityGMLでは、地物型として定義されていないが、地物属性を使うと表現できる場合がある。地物型及びその地物属性で区分可能な場合は、i-UR又はCityGMLに存在するものとして扱う。例えば、i-UR及びCityGMLには、「鳥獣保護区」という地物型はない。しかし、i-URには、区域（urf:Zone）という地物型は定義されており、この地物型の定義は「法令により定められた区域」である。そこで、この地物型の属性functionの定義域に「鳥獣保護区」を追加することで、鳥獣保護区を表現可能となる。

このような場合には、表2-9のb-2ではなく、b-1のパターンに該当するとして製品仕様を拡張すること。
前述の例の場合、「鳥獣保護区」という新しい地物型を追加するのではなく、i-URに定義されている「urf:Zone」の属性の定義域を拡張する。

注記2.4.1の注記不足する地物型等を拡張製品仕様として追加する場合、i-URやCityGMLに定義されている地物型等を引用する。特にCityGMLには、都市を構成する様々な地物型が定義されているため、地物型については、概ねCityGMLから引用できる。また、概念的な区域を追加したい場合は、「urf:Zone」を拡張することで記述可能となる。

一方で、CityGMLでは、特定のユースケースが想定されておらず、基本的な地物属性しか定義されていない。そのため、ユースケースが要求する詳細な地物属性は、拡張手順に従い追加が必要になる場合がある。

## 2.4.2 製品仕様の拡張手順

製品仕様の拡張手順を、2.4.1で示したパターンごとに示す。

## 2.4.2.1 コード型の地物属性を追加する場合

コード型の地物属性を追加したい場合は、以下の手順に従う。

- 【手順】
- **手順1．A.3.3に示す様式に従い、追加したいコード型の属性（拡張属性）のリストを作成する。作成例を表2-10に示す。**：拡張属性のリストは、以下に示す事項を守り、作成すること。
  
- **手順2．A.3.2に示す様式に従い、追加した拡張属性ごとに、定義域を示すコードリストを作成する。作成例を表2-11に示す。**：コードリストは、以下に示す事項を守り、作成すること。
  

　

注記2.4.2.1の注記コード型（gml:CodeType）とは、取りうる値があらかじめコードとしてリスト化され、その中からコードを選択して記述するデータ型である。コード型の属性を追加する場合は、追加した属性ごとに「コード及びコードに対応する説明のリスト」（コードリスト）が必要となる。

CityGMLでは、定義済みの地物型に地物属性を追加するための汎用的な属性が、値の型ごとに用意されている（1.2参照）が、コード型をとる汎用的な属性の型は用意されていない。コード型は取りうる値をコードリストに定義することでデータの品質管理を容易にする利点があることから、本書では、コード型の属性を追加する場合は、i-URに定義されている拡張属性を採用することとしている。

なお、i-UR3.0（標準製品仕様書第3.5版までに対応）では、建築物にのみコード型の属性を追加する拡張属性の仕組みが定義されていたが、i-UR3.1（標準製品仕様書第4.1版に対応）では、道路や土地利用など、様々な地物型にこの拡張属性の仕組みが追加されたことから、本書では、全ての地物型について、コード型の属性を追加する場合は、拡張属性を採用する。

## 2.4.2.2 コード型以外の地物属性又は地物関連を追加する場合

コード型以外の地物属性を追加したい場合、また、地物関連を追加したい場合は、汎用属性（gen:_GenericAttribute）の下位型を使用し、以下の手順により拡張する。

- 【手順】
- 手順1．A.3.6の様式「汎用属性」に従い、地物ごとに追加する地物属性及び地物関連のリストを作成する。地物型には、地物属性及び地物関連を追加する地物型の名称を記述する。ただし、汎用都市オブジェクト（gen:GenericCityObject）に地物属性及び地物関連を追加する場合は、追加の対象を明確にするため、gen:GenericCityObjectのgml:nameの値を注釈として記述する。地物属性の型は汎用属性の下位型である以下のいずれかから選択する。gen:stringAttribute（文字列型）gen:intAttribute（整数型）gen:doubleAttribute（実数型）gen:dateAttribute（日付型）gen:uriAttribute（URI型）gen:measureAttribute（単位付き計測値型）
 gen:measureAttributeを使用する場合は、uom属性により、その単位を指定しなければならない。長さの単位は「メートル」（uom=”m”）、大きさの単位は「平方メートル」（uom=”m2”）又は「ヘクタール」（uom=”ha”）、時間の単位は「時間」（uom=”hour”）を基本とする。gen:genericAttributeSet（汎用属性セット型）
 gen:genericAttributeSetは、複数の汎用属性の集まりである。 
 gen:genericAttributeSetは、gen:stringAttributeやgen:intAttributeなどの汎用属性を複数個組み合わせてひとまとめにできる。地物関連の型は汎用属性の下位型である以下を選択する。gen:uriAttribute（URI型）「名称」には、追加したい地物属性又は関連役割の名称を記述する。このとき、同じ地物型に、同じ地物属性や関連役割の名称を与えてはならない。「定義」には、追加する地物属性又は地物関連の説明を記述する。取りうる値が限定される場合には「定義域」に記述する。その他特筆事項がある場合には「注釈」に記述する。表2-12に、汎用属性を用いて属性を追加する場合の例を示す。表2-12 — 汎用属性の追加例地物型gen::GenericCityObject注釈gml:name=20の場合に適用汎用属性属性の型名称定義多重度定義域単位注釈gen::stringAttribute通学区域名称通学区域に指定された就学校の名前1全角20文字以内－汎用都市オブジェクト（gen:GenericCityObject）は、拡張属性（2.4.2.1参照）を使用することができない。そのため、汎用都市オブジェクトにコード型の属性を追加する場合は、コードと参照するコードリストの対をgen:genericAttributeSetとして追加することを推奨する。コードを格納する汎用属性の名称は、codeとする。コードリストのファイル名称を格納する汎用属性の名称は、codeSpaceとする。いずれも属性の型は文字列型（gen:stringAttribute）とする。コードリストの名称は、`[地物型名称]_generic-[オプション]`とする。`[地物型名称]`は、応用スキーマクラス図に示される地物型の名称（接頭辞は除く）とする。`[オプション]`は任意の半角英数字とするが、同じ地物型の中では重複してはならない。なお、gen:GenericCityObjectにコード型の属性を追加する場合、コードリストの名称は
 `GenericCityObject_generic-[オプション]`
となる。gen:GenericCityObjectを用いて複数種類の地物を追加する場合は、どの地物に対するコードリストであるかが分かりづらくなるため、 `[オプション]`は追加する
 `[地物の名称]-[属性の名称]`
とする。地物の名称は、gml:nameにおいて指定されるコードとする。属性の名称は、半角英数字で構成される任意の文字列とする。ただし、gml:nameが同じとなる地物に定義する属性の中では一意でなければならない。例えば、gen:GenericCityObjectを使用して「通学区域」（gml:name=”20”）を追加し、かつ、汎用属性セットを使って「通学区域」の種類をコード型の属性として追加する場合、コードリストの名称は、GenericCityObject_generic-20-typeとなる。コードリストの名称は、gen:stringAttributeとして追加したcodeSpaceの定義域に記載する。コード型を追加する場合の汎用属性セットの使用例を表2-13に示す。表2-13 — 汎用属性セットの使用例名称施設一覧注釈汎用都市オブジェクトのうち、name=20の場合に適用する。汎用属性セット市内に存在する公共施設の名称を一覧から選択し記述するための汎用属性セット。
コード型の代替として使用することを目的とし、codeSpaceに公共施設名称のコードリストへの相対パスを記述し、codeに当該コードリストに定義された値を記述する。汎用属性セットに含まれる汎用属性属性の型名称定義多重度定義域単位注釈gen::stringAttributecodeSpace公共施設名称一覧への参照。1相対パスにより記述する。gen::stringAttributecode公共施設を示すコード。1公共施設名称一覧に定義されたコード。gen:genericAttributeSetには、gen:genericAttributeSetを含めてはならない。CityGMLでは、gen:genericAttributeSetがgen:genericAttributeSetをもつこと（ネスト構造）が可能である。ただし、データ構造の階層が深くなるため、3D都市モデルではネスト構造を使用しない。
-  注記2.4.2.2の注記i-URでは、拡張属性としてコード型の属性を追加する仕組みをADEに定義している。しかしながら、gen:GenericCityObjectは、CityGMLにおいて暫定的な拡張方法という位置づけから、ADEで追加された属性等をもつ仕組みが用意されていない。そのため、汎用属性セットを使って、コードの値とコードリストへの参照をひとかたまりとして追加する方法を推奨している。「汎用属性セット」を用いると、複数の汎用属性をひとかたまりとして追加できる。例えば、建物の改修履歴に関する情報として、改修時期、改修内容、改修事業者名を追加したいとする。この場合、改修履歴という汎用属性セットを作成し、この汎用属性セットに改修時期、改修内容、改修事業者名をそれぞれ汎用属性として加えればよい。これにより、建物に複数回の改修工事があった場合でも、改修工事ごとにまとめて改修履歴として改修時期、改修内容、改修事業者名を記述できるようになる。同様にして、汎用属性セットを使用すると、コードとこれが参照するコードリストをまとめて記述できる。これにより、プログラムによるコードリストを使った論理検査の実施が容易になる。また、今後CityGML3.0に移行する際に、追加したコード型の汎用属性に変換することができる。

## 2.4.2.3 i-UR又はCityGMLに存在する地物型等を追加する場合

標準製品仕様書に定義されていないが、i-UR又はCityGMLのいずれかに定義されている地物型等を追加する場合には、以下の手順により拡張する。

- 【手順】
- **手順1．追加したい地物型等について、応用スキーマクラス図及び応用スキーマ文書を作成する。応用スキーマクラス図は、i-UR及びCityGMLの仕様（1.2参照）に従う。また、応用スキーマ文書の作成には、A.3.4に示す様式を用いる。**：応用スキーマ文書は、以下の事項を守り作成すること。
  
-  注記2.4.2.3の注記追加したい地物型等が、i-UR又はCityGMLに存在する場合には、これらから矛盾なく引用しなければならない。属性の型や多重度は原則として変更できないが、より制限を強めることはできる。例えば、多重度が[0..1]となっている地物属性を[1]としてもよい。また、文字列型となっている属性の定義域を「全角10文字以内」というように制限してもよい。ただし、i-URやCityGMLそのものを変更することはできないため、符号化仕様（XMLSchema）についても修正は行えない。よって、符号化仕様を使った妥当性の検証ができないことに注意すること。例：多重度が[0..1]となっている属性を、応用スキーマ文書で[1]にした場合であっても、符号化仕様では、[0..1]のままとなるため、当該属性が記述されていなくてもエラーとしては検出されない。別途検証ツールを作成する必要がある。本書では、3D都市モデルが様々な用途・ソフトウェア上で利用され、より普及していくことを目指し、複数の選択肢がある場合には、より実装例の多い選択肢の使用を推奨している。

## 2.4.2.4 i-URやCityGMLに存在しない地物型を追加する場合

標準製品仕様書に定義されておらず、i-UR及びCityGMLにも定義されていない地物型を追加する場合には、CityGMLに定義されているgen:GenericCityObjectを使用し、以下の手順により拡張する。

- 【手順】
- **手順1．様式に示される汎用都市オブジェクトの名称リスト（GenericCityObject_name.xml）に、追加する地物型のコード及び説明を追加する。表2-14に例を示す。**：汎用都市オブジェクトの名称リストは、以下の事項を守り作成すること。
  
- **手順2．追加する地物型の応用スキーマ文書を作成する。応用スキーマ文書の作成は、A.3.5に示すgen:GenericCityObjectの応用スキーマ文書を加工する。 これは、 追加する地物型ごとに行う。**：汎用都市オブジェクトの応用スキーマ文書は、以下の事項を守り作成すること。
  

- 手順3．前項において、コード型の属性を選択する場合には、拡張コードリスト（表2-16）を作成する。表2-16 — 汎用都市オブジェクトのためのコードリスト作成例ファイル名genericCityObject_function.xmlコード説明1小学校2中学校
- 手順4．新しく追加した地物型に、gen:GenericCityObjectに定義されていない地物属性及び地物関連を追加する場合には、次項に示す地物属性/地物関連を追加する手順に従う。

