# 5.4.2 作業上の留意事項

## 5.4.2 作業上の留意事項

出力したデータについても、附属書B及び附属書Uに示す要件を満たさなければならない。以下に、本作業で生じうるエラーに対する留意事項を示す。

**表 5-16 — 33: 要素への接頭辞付与**

| ID | `/att/quality/12` |
| --- | --- |
| 主題 | 標準作業手順 |
| 分類 | 要件分類4: 3D都市モデル作成手順と品質評価の留意事項 |
| 条文 | 全ての要素に必ず接頭辞を付ける。複数の名前空間に定義された符号化仕様を使用しているため、混乱を生じないよう、全ての要素に接頭辞を付ける。 |

**表 5-17 — 34: `gml:id`の付与ルール**

| ID | `/att/quality/13` |
| --- | --- |
| 主題 | 標準作業手順 |
| 分類 | 要件分類4: 3D都市モデル作成手順と品質評価の留意事項 |
| 条文 |  gml:idの付与ルールに従う。gml:idは、データ集合内でオブジェクトを識別するためのIDである。3D都市モデルでは、このgml:idに `[接頭辞]_[UUID]`を使用する。`[接頭辞]`は、製品仕様書に示す、CityGML及びi-URの各パッケージに与えられた接頭辞（表5-18）とする。また、`[UUID]`は、Universally Unique Identifierとする。 |

**表 5-18 — 接頭辞**

| 応用スキーマ | ← | 接頭辞 |
| --- | --- | --- |
| 建築物モデル | ← | bldg |
| 交通（道路）モデル | ← | tran |
| 交通（鉄道）モデル | ← | rwy |
| 交通（徒歩道）モデル | ← | trk |
| 交通（広場）モデル | ← | squr |
| 交通（航路）モデル | ← | wwy |
| 土地利用モデル | ← | luse |
| 災害リスク（浸水）モデル | 洪水浸水想定区域 | fld |
| ↑ | 津波浸水想定 | tnm |
| ↑ | 高潮浸水想定区域 | htd |
| ↑ | 内水浸水想定区域 | ifld |
| ↑ | ため池ハザードマップ | rfld |
| 災害リスク（土砂災害）モデル | 土砂災害警戒区域 | lsld |
| 都市計画決定情報モデル | ← | urf |
| 橋梁モデル | ← | brid |
| トンネルモデル | ← | tun |
| その他の構造物モデル | ← | cons |
| 都市設備モデル | ← | frn |
| 地下埋設物モデル | ← | unf |
| 地下街モデル | ← | ubld |
| 植生モデル | ← | veg |
| 地形モデル | ← | dem |
| 水部モデル | ← | wtr |
| 区域モデル | ← | area |
| 汎用都市オブジェクト | ← | gen |
| アピアランスモデル | ← | app |
| 拡張製品仕様書で追加した地物（ただし、urf:Zoneを継承する地物を除く） | ← | ext |

**表 5-19 — 35: XMLタグの出現順序**

| ID | `/att/quality/14` |
| --- | --- |
| 主題 | 標準作業手順 |
| 分類 | 要件分類4: 3D都市モデル作成手順と品質評価の留意事項 |
| 条文 |  XML文書におけるタグの出現順序は、XMLSchemaにおいて定められた順序とする。XMLで出現するタグは、あらかじめXMLSchemaによりその順序が決まっている。具体的には以下の順序で出現することが基本となる。これらの順序を守らない場合、論理一貫性に不適合となる。 1）gml:*  2）core:*  3）gen:*  4）bldg:*、tran:*等CityGMLの地物型で定義された属性・関連役割 5）uro:*、urf:*等i-URで定義された属性・関連役割UMLクラス図で記述された属性や関連役割がXML文書のタグとして出現する。UMLクラス図で記述された属性と関連役割には順序の概念がない。一方、XMLSchemaでは順序をもつ。そのため、UMLクラス図の記述だけでは、XMLSchemaでの出現順序が分からない。データ出力時には、XMLSchemaにおいて出現順序を確認し、定められた順序となるよう注意すること。ただし、ポイントクラウドモデルはcore:_CityObjectに拡張を行っているため、ポイントクラウドと関連付けた都市オブジェクトのインスタンスに関してはcore:_CityObjectを継承する各都市オブジェクトに定義された属性（例：bldg:class）などよりも前にuro:pointCloudのタグが出現する。また、植生モデルは、uro:を接頭辞とする属性及び関連役割が、CityGMLで定義された接頭辞veg:よりも前に出現してよい。接頭辞veg:よりも前に出現してよいタグは、veg:SolitaryVegetationObject及びveg:PlantCoverの上位の地物型である、veg:_VegetationObjectに拡張された属性及び関連役割（uro:vegDataQualityAttribute、uro:vegFacilityIdAttribute、uro:vegFacilityTypeAttribute、uro:vegFacilityAttribute、uro:vegKeyValuePairAttribute及びuro:vegDmAttribute）である。 |

**表 5-20 — 36: 主題属性には「不明」値も含めて出力**

| ID | `/att/quality/15` |
| --- | --- |
| 主題 | 標準作業手順 |
| 分類 | 要件分類4: 3D都市モデル作成手順と品質評価の留意事項 |
| 条文 | 作成対象となる主題属性は、「不明」値も含めて出力する。一つの応用スキーマの単位で作成対象とする主題属性を決定した場合は、原典資料に基づき「不明」の値も含めて全ての都市オブジェクトに必ずタグを作成する。「不明」値は、基本となるデータ型ごとに指定された不明を表す値（留意事項30参照）を使用すること。CityGML及びi-URで定義された属性の多くは多重度が`[0..1]`であり、省略可能である。しかし、作成対象であるデータについてタグを省略すると、データがないのか、不明なのか、又はエラーで漏れているのかがわからなくなるため、不明であることを明示する必要がある。例えば、「都市計画基礎調査（建物利用現況）」を原典資料として「建築物モデル」の主題属性「bldg:usage」を作成することとした場合、原典資料によって、「不明」の場合に不明値のコードが入力されている場合と、値が空となっている場合（調査対象ではあるが値を入れていない場合）が混在する。後者のような場合には、作業機関の作業によって、「不明」の範囲を特定し、主題属性「bldg:usage」には不明を表すコード値（461）を出力する。補足：「洪水浸水想定区域図」を原典資料として、「建築物モデル」の主題属性「uro:BuildingRiverFloodingRiskAttribute」を作成することとするような場合、原典資料の範囲外の値は存在しない。このような場合は、「不明」ではなく「不存在」なので、値を出力する必要はない。 |

**表 5-21 — 37: 作成対象外のタグは作成しない**

| ID | `/att/quality/16` |
| --- | --- |
| 主題 | 標準作業手順 |
| 分類 | 要件分類4: 3D都市モデル作成手順と品質評価の留意事項 |
| 条文 | 作成対象ではない地物型等のタグは作成しない（空タグを作成しない）。i-UR やCityGMLには様々な地物型や属性が定義されている。作成対象としない地物型及び属性は、空タグ（値を入れないタグ）を作成しない。 |

**表 5-22 — 38: 単位付き数値には必ずuom属性を指定**

| ID | `/att/quality/17` |
| --- | --- |
| 主題 | 標準作業手順 |
| 分類 | 要件分類4: 3D都市モデル作成手順と品質評価の留意事項 |
| 条文 | 単位付き数値型の属性には、かならずuom属性により、単位を指定する。単位付き数値とは、50.0m, 50haのように、数値に単位を付する属性の型である。原典資料では単位が省略されている場合があるが、符号化仕様において単位付き数値で記述することが指定されている場合には、単位を付与する。例1 — 記述例標準製品仕様書では原則として、長さの単位は“メートル”、面積の単位は“平方メートル”又は“ヘクタール”、時間の単位は“時間”を採用している。uom属性にはそれぞれ“m”、”m2”、”ha”、”hour”を記述する。 |

**表 5-23 — 39: コードリストとcodeSpaceの指定**

| ID | `/att/quality/18` |
| --- | --- |
| 主題 | 標準作業手順 |
| 分類 | 要件分類4: 3D都市モデル作成手順と品質評価の留意事項 |
| 条文 | コードは、あらかじめ用意されたコードリストに列記されたコードから一つを選択し、値として記述する。このとき、用意されたコードリストの所在をcodeSpace属性に記述する。コードリストは3D都市モデルのファイルからの相対パスによる記述とする。相対パスは、成果品のフォルダ構成に従う（第6章参照）。例2 — 記述例：相対パスによるcodeSpaceの指定の例 |

**表 5-24 — 40: コード型属性の汎用属性セット**

| ID | `/att/quality/19` |
| --- | --- |
| 主題 | 標準作業手順 |
| 分類 | 要件分類4: 3D都市モデル作成手順と品質評価の留意事項 |
| 条文 | 汎用属性セットを用いてコード型の属性を追加した場合には、コードが参照するコードリストの所在を記述する文字列型の汎用属性（name=“codeSpace”）とコードを記述する文字列型の汎用属性（name=“code”）との対として符号化する。例3 — 記述例：都市設備（CityFurniture）に追加する場合例4 — 記述例：汎用都市オブジェクト（GenericCityObject）に追加する場合コードリストの所在の記述は、gml:CodeTypeを使用したcodeSpace属性による指定と同様とする。 |

**表 5-25 — 41: データ出力時の変換エラーに注意**

| ID | `/att/quality/20` |
| --- | --- |
| 主題 | 標準作業手順 |
| 分類 | 要件分類4: 3D都市モデル作成手順と品質評価の留意事項 |
| 条文 | データ出力時における変換エラーに留意する。幾何オブジェクトの作成や、属性の追加において正しくデータが作成されているにも関わらず、符号化する際の変換プログラムの誤りにより、エラーが生じることに留意すること。特に、以下の事項を確認する。変換元となる空間参照系と、変換先となる空間参照系が正しく設定されているか。コード型の主題属性について、原典資料独自のコードから指定したコードに正しくマッピングされているか。また、正しいコードリストを参照しているか。単位付き数値型の属性が、指定した単位に変換されているか。不要なNULL値が出力されていないか。また、不要な空タグが出力されていないか。座標列は、緯度、経度、標高の順列となっているか（経度、緯度、標高の順列は誤り）。面を構成する座標列の向きは左回りになっているか（右回りは誤り）。 |

**表 5-26 — 42: i-URの符号化仕様は相対パスで指定**

| ID | `/att/quality/21` |
| --- | --- |
| 主題 | 標準作業手順 |
| 分類 | 要件分類4: 3D都市モデル作成手順と品質評価の留意事項 |
| 条文 |  i-URの符号化仕様は相対パスによりschemaLocationを指定する。CityGML形式に出力したファイルのschemaLocationの指定は、3D都市モデルの成果品に含めるi-URの符号化仕様のファイルへの相対パスとする。地物型又はモジュールごとに分けられた3D都市モデルの成果品を格納するフォルダ（例：bldg,tran）の直下に格納した3D都市モデルファイルの場合、schemaLocationとして記述すべき符号化仕様への相対パスは以下となる。`urbanObject.xsdへの相対パス：`../../schemas/iur/uro/3.2/urbanObject.xsd`urbanFunction.xsdへの相対パス：`../../schemas/iur/uro/3.2/urbanFunction.xsd |

**表 5-27 — 43: 部分更新時のデータ漏れ・重複確認**

| ID | `/att/quality/22` |
| --- | --- |
| 主題 | 標準作業手順 |
| 分類 | 要件分類4: 3D都市モデル作成手順と品質評価の留意事項 |
| 条文 | 部分更新となる場合は、統合したデータに漏れや重複が無いことを確認する。既に3D都市モデルが存在しており、その一部を更新する場合は、更新した3D都市モデルと更新していない3D都市モデルとを統合し、一式とする必要がある。そのため、統合した際にデータの漏れや重複が無いことを確認する。 |

**表 5-28 — 44: 変換プログラムのデフォルト値確認**

| ID | `/att/quality/23` |
| --- | --- |
| 主題 | 標準作業手順 |
| 分類 | 要件分類4: 3D都市モデル作成手順と品質評価の留意事項 |
| 条文 | 変換プログラムのデフォルト設定に注意する。データ出力に使用する変換プログラムによっては、必須となる属性等にデフォルト値が用意されている場合がある。デフォルト値が標準製品仕様書の指定する値と異なる場合もあるため、設定を確認する。app:Appearance の属性app:themeの値を標準製品仕様書では、“rgbTexture”と指定している。データ変換ツールとして一般的に使用されている商用ツールであるFMEを使って変換する場合、この値の指定をしなければ、デフォルトで“FMETheme”と入力される。 |

**表 5-29 — 45: LOD別の地物は同一ファイルに出力**

| ID | `/att/quality/24` |
| --- | --- |
| 主題 | 標準作業手順 |
| 分類 | 要件分類4: 3D都市モデル作成手順と品質評価の留意事項 |
| 条文 | 一つの都市オブジェクトを異なるLODで記述した場合、一つの地物インスタンスとして同じファイルに出力することを基本とする。3D都市モデルの各地物型には、LOD0からLOD4までの複数の空間属性が定義されている。これにより一つの都市オブジェクトを詳細度の異なる複数の幾何オブジェクトで表現することができる。このとき、同じ都市オブジェクトについてのLODが異なる複数の幾何オブジェクトは、同一の地物インスタンスに含まれる各LODの幾何オブジェクトとして同じファイルに出力することを基本とする。ただし、地形モデル（LOD3）の場合は、ファイル名のオプション（lod3）を用いてファイルを分けてもよい。これは、地物の単位が基準地域メッシュであることから、同一の地物インスタンスに複数のLODを格納することでデータ量が膨大となり、操作性が低下することを避けることを目的としている。 |

