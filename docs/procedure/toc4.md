# 5 3D都市モデル作成と品質評価

## 5 3D都市モデル作成と品質評価

## 5.1 概要

本章では、収集した既存資料及び取得した新規データを原典資料として、3D都市モデルの作成を行う手順を示す。この手順には、それぞれの工程での品質評価を含む。これは成果品とりまとめにおける手戻りを防ぐことを目的としている。

図5-1に3D都市モデル作成の手順を示す。3D都市モデル作成は、まずGIS、CAD等のツールを使用して都市オブジェクトの空間属性である幾何オブジェクト（立体等）を作成し、次に、幾何オブジェクトに属性を追加する。最後に、製品仕様に規定された符号化仕様（i-UR及びCityGML）に従い出力する、という手順で行うことを基本とする。ただし、使用するツールの特性に合わせ、幾何オブジェクトの作成と属性追加の順序を入れ替えてもよい。また、既存資料として幾何オブジェクトが存在している場合のように、これらの手順は省略される場合がある。

![Image](images/toc4_img001.png)

地物型ごとに取りうる幾何型や満たすべき要件が異なる。そこで、地物型ごとに幾何型や満たすべき要件を示す。また、要件を満たす標準的な作業手順及び作業上の留意事項を示す。3D都市モデル作成にあたっては、本書の本編に示す留意事項等に加え、表5-1に示す地物型に対応する付属書を参照すること。

**表 5-1 — 地物型と付属書**

| 付属書 | 地物型 | 付属書 | 地物型 | 付属書 | 地物型 |
| --- | --- | --- | --- | --- | --- |
| 附属書C | 建築物 | 附属書J | 災害リスク | 附属書Q | 地下街 |
| 附属書D | 交通（道路） | 附属書K | 都市計画決定情報 | 附属書R | 植生 |
| 附属書E | 交通（鉄道） | 附属書L | 橋梁 | 附属書S | 地形 |
| 附属書F | 交通（徒歩道） | 附属書M | トンネル | 附属書T | 水部 |
| 附属書G | 交通（広場） | 附属書N | その他の構造物 | 附属書U | 区域 |
| 附属書H | 交通（航路） | 附属書O | 都市設備 |  |  |
| 附属書I | 土地利用 | 附属書P | 地下埋設物 |  |  |

3D都市モデル作成手順と品質評価の要件は下表のとおりである（各規定の詳細は各規定の表を参照のこと）。

**表 5-2 — 4: 3D都市モデル作成手順と品質評価の留意事項**

| ID | `/req/quality` |
| --- | --- |
| 対象の種類 | 標準作業手順 |
| 説明 | 3D都市モデル作成手順と品質評価の留意事項 |
| 規定 | 留意事項22: LODによる形状の再現性の違いについて留意事項23: 都市オブジェクトの区切り留意事項24: LOD毎の幾何品質情報の記録留意事項25: データ型の整合性留意事項26: 不整合の対処方法留意事項27: 建築物の属性「uro:city」の必須記述留意事項28: 建築物の用途列挙留意事項29: コード型属性の追加留意事項30: 不明値の指定方法留意事項31: NULL値と不明値の変換留意事項32: 主題属性の品質記録留意事項33: 要素への接頭辞付与留意事項34: `gml:id`の付与ルール留意事項35: XMLタグの出現順序留意事項36: 主題属性には「不明」値も含めて出力留意事項37: 作成対象外のタグは作成しない留意事項38: 単位付き数値には必ずuom属性を指定留意事項39: コードリストとcodeSpaceの指定留意事項40: コード型属性の汎用属性セット留意事項41: データ出力時の変換エラーに注意留意事項42: i-URの符号化仕様は相対パスで指定留意事項43: 部分更新時のデータ漏れ・重複確認留意事項44: 変換プログラムのデフォルト値確認留意事項45: LOD別の地物は同一ファイルに出力留意事項46: 全ての都市オブジェクトにデータ品質属性を付与留意事項47: 公共測量成果を用いた場合の品質属性作成 |

## 5.2 幾何オブジェクトの作成と品質評価

## 5.2.1 幾何オブジェクトの作成

ここで作成された幾何オブジェクトは附属書Bに示す妥当な幾何オブジェクトの要件を満たさなければならない。また、地物型ごとに取りうる幾何型や満たすべき要件が異なるため、附属書Cから附属書Uに示す地物型ごとの要件を満たすこと。

地物型が取りうる幾何型は、0次元の幾何である点（gml:Point又はgml:MultiPoint）、1次元の幾何である線（gml:MultiCurve）、2次元の幾何である面（gml:MultiSurface）又は、3次元の幾何である立体（gml:Solid）のいずれかである。点、線及び面の作成は、基盤地図情報をはじめとする2次元の地図作成において採用される手法に従う。ここでは、建築物を例として3D都市モデルとして新たに追加される立体（gml:Solid）の作成手順を示す。

なお、幾何オブジェクトの作成においては、各都道府県や市区町村が定める公共測量作業規程又は、作業規程の準則（国土交通省国土地理院）に従うこと。また3Dの立体の図化においては「[3D都市モデル整備のための測量マニュアル](https://www.mlit.go.jp/plateau/libraries/)」を参考とする。

## 5.2.1.1 LOD1のgml:Solidの作成

LOD1の立体を作成する場合、その立体は、外形となるgml:MultiSurfaceを上下の面とする角柱として記述する。

- 【手順】
- 手順1．外形データ（面）を作成する。
 LOD0の幾何オブジェクトが面の場合は、LOD0の幾何オブジェクトを外形データとして使用できる。 
 LOD0の幾何オブジェクトが線（外形線）の場合は、始終点を一致させた面として加工し、外形データとすることができる。
- 手順2．外形データと標高データとを重ね合わせ、最も低い標高を取得する。
標高データには、DEM（数値標高モデル）又は点群データから生成したTIN（不規則三角網）データを使用する。
- 手順3．都市オブジェクトの高さデータを取得する。
- 手順4．外形データの高さ座標として、手順2．で取得した最も低い標高を与えた面を下面、手順3．で取得した高さデータを与えた面を上面とする角柱を作成する（図5-2）。
- 手順5．品質評価を実施する。

![Image](images/toc4_img002.png)

　

注記5.2.1.1の注記LOD1の立体は、外形データ（面）を一律の高さで押し出して作成することから、プログラムによる自動生成が可能である。

## 5.2.1.2 LOD2のgml:Solidの作成

LOD2では、都市オブジェクトの特徴的な外観が再現される。LOD2として再現すべき都市オブジェクトの形状は、地物型によって異なる。附属書Cから附属書Uに示すLOD2の定義に従うこと。

- 【手順】
- 手順1．都市オブジェクトの外観を構成する各面を取得する。
 LOD2は、建築物の屋根形状のように、都市オブジェクトの上面の形状を詳細化することが基本となる。 
 LOD2に要求される位置正確度を満たす場合には、LOD0やLOD1の幾何オブジェクトを加工し、LOD2の幾何オブジェクトを作成できる。
- 手順2．手順1．で作成した各面を境界とする立体を作成する。
- 手順3．品質評価を実施する。

![Image](images/toc4_img003.png)

LOD2の立体を作成する場合、立体を構成する境界面がより詳細な地物型（部品）として定義される場合がある。例えば、建築物（bldg:Building）の場合は、その境界面となる屋根面（bldg:RoofSurface）や外壁面（bldg:WallSurface）が該当する（図5-3）。このような場合には、取得した各面を該当する都市オブジェクトに分類する必要がある。

標準製品仕様では、原則としてLOD2.0を採用するが、ユースケースに応じて、LOD2.1やLOD2.2等の詳細なLODを選択できる。

注記5.2.1.2の注記LOD2の立体は、LOD1とは異なり、都市オブジェクトの外観の特徴を再現する必要がある。このとき、LOD0やLOD1の幾何オブジェクトを加工することで効率的にLOD2を作成することができる。

ただし、LOD0やLOD1の幾何オブジェクトを使用する場合には、この位置正確度がLOD2に要求される位置正確度と同等以上でなければならない。例えば、地図情報レベル500の位置正確度がLOD2の幾何オブジェクトに求められている場合、地図情報レベル2500で作成されたLOD1の幾何オブジェクトを使用することはできないが、LOD2の品質要求が地図情報レベル2500である場合には、LOD1の幾何オブジェクトを使用できる。

例1 — 手動によるLOD2建築物の作成手順（DSMに合わせた修正）- LOD1の幾何オブジェクトとDSMを重ねて表示する。
- LOD1の幾何オブジェクトの高さを、建築物の軒下の高さに合わせる。
- 面の分割、押し出し機能等を使用し、DSMに合わせて立体を修正する。

例2 — 自動によるLOD2建物作成手順（専用ソフトウェアを使用した屋根形状へのテンプレート適用）- LOD0の幾何オブジェクトとDSMを重ねる。
- 屋根形状のテンプレート（陸屋根、切妻、寄棟等）を用いてDSMとの一致度が最も高いテンプレートを当てはめる。
- 屋根形状に合わせて壁面を作成する。

## 5.2.1.3 LOD3のgml:Solidの作成

LOD3では、LOD2よりもさらに詳細に都市オブジェクトの詳細な外観が再現される。LOD3として再現すべき都市オブジェクトの形状は、地物型によって異なる。附属書Cから附属書Uに示すLOD3の定義に従うこと。

- 【手順】
- 手順1．都市オブジェクトの外観を構成する各面を取得する。
 LOD3は、建築物の壁面のように、都市オブジェクトの側面の形状を詳細化することが基本となる。 
 LOD3に要求される位置正確度を満たす場合には、LOD2の幾何オブジェクトを加工し、LOD3の幾何オブジェクトを作成できる。
- 手順2．手順1．で作成した各面を境界とする立体を作成する。
- 手順3．品質評価を実施する。

![Image](images/toc4_img004.png)

LOD3の立体を作成する場合、立体を構成する境界面がより詳細な地物型（部品）として定義される場合がある。例えば、建築物（bldg:Building）の境界面となる屋根面（bldg:RoofSurface）や外壁面（bldg:WallSurface）には、LOD3では窓（bldg:Window）や扉（bldg:Door）を追加できる（図5-4）。このような場合には、取得した各面を該当する都市オブジェクトに分類する必要がある。

LOD3は、都市オブジェクトの外観を記述する最も詳細なLODである。標準製品仕様では、原則としてLOD3.0を採用するが、ユースケースに応じて、LOD3.1やLOD3.2等の詳細なLODを選択できる。

注記5.2.1.3の注記LOD3は、都市オブジェクトの外観を記述する最も詳細なLODである。LOD3を点群データや画像からの図化により作成する場合、その作業量から作成費用が高額となる恐れがある。そのため、ユースケースに応じて、取得対象やその取得の内容を選択することが必要である。

また、LOD3の都市オブジェクトの作成においては、
測量に限らず、BIM（Building Information Modeling）のデータを活用してもよい。 
 BIMデータの活用については、「 [PLATEAU Handbook #03](https://www.mlit.go.jp/plateau/libraries/handbooks/)」を参照するとよい。

## 5.2.1.4 LOD4のgml:Solidの作成

LOD4では、LOD3の詳細な都市オブジェクトの詳細な外観に加えて、都市オブジェクトの内部の形状が再現される。LOD4として再現すべき都市オブジェクトの形状は、地物によって異なる。附属書Cから附属書Uに示すLOD4の定義に従うこと。

- 【手順】
- 手順1．都市オブジェクトの内部の空間を構成する各面を取得する。
- 手順2．手順1．で作成した各面を境界とする立体を作成する。
- 手順3．品質評価を実施する。

![Image](images/toc4_img005.png)

LOD4は、都市オブジェクトの外観に加えて、内部の形状を再現する最も詳細なLODである（図5-5）。標準製品仕様では、原則としてLOD4.0を採用するが、ユースケースに応じて、LOD4.1やLOD4.2等の詳細なLODを選択できる。

LOD4は都市オブジェクトの内部の形状を再現することから、その作成においてはCADやBIMなどの設計データを活用することが基本となる。ただし、測量により取得できる場合には測量により取得してもよい。

## 5.2.2 作業上の留意事項

幾何オブジェクトの作成時におけるデータ作成負荷を軽減することを目的とする作業上の留意事項を示す。ただし、幾何オブジェクトの作成においては、附属書Bに示す妥当な幾何オブジェクトの要件を満たさなければならない。

**表 5-3 — 22: LODによる形状の再現性の違いについて**

| ID | `/att/quality/1` |
| --- | --- |
| 主題 | 標準作業手順 |
| 分類 | 要件分類4: 3D都市モデル作成手順と品質評価の留意事項 |
| 条文 | LODにより都市オブジェクトの形状の再現性が異なる。建築物、橋梁、トンネル及び都市設備は、LOD1は、外周に一律の高さを与えて上向きに押し出した立体となり、LOD2はLOD1から上部を詳細化し、LOD3では側方を詳細化することが基本となる。そのため、LOD1では、一律の高さで立ち上げることで、実際の形状と乖離する場合がある。下記図は、建物正面玄関に存在する階段の両端にあたる部分が建物外形線として取得されていたため、LOD1による一律の押し出しにより、実際の形状と乖離した例である。![Image](images/toc4_img006.png)実際の建築物の形状と乖離するLOD1建築物（中央）の例また、LOD1及びLOD2では、他の都市オブジェクトに隠れ、上空から正射影が取得できない場合は作成されない。下記図は複合的な都市設備について、下部に設置された標識がLOD1やLOD2では再現されない例である。![Image](images/toc4_img007.png)他の都市設備に隠れ、LOD1及びLOD2では取得されない都市設備の例このようなLODごとの再現性の違いを考慮し、データ作成対象とするLODを決定する必要がある。 |

**表 5-4 — 23: 都市オブジェクトの区切り**

| ID | `/att/quality/2` |
| --- | --- |
| 主題 | 標準作業手順 |
| 分類 | 要件分類4: 3D都市モデル作成手順と品質評価の留意事項 |
| 条文 | 都市オブジェクトは、地物の外形（LOD0、LOD1、LOD2及びLOD3）とこれに加えて地物の内形（LOD手順4．を示す境界により区切ることが基本となる。ただし、道路や地形のように、連続して存在する地物は、外形や内形を示す境界以外の場所で区切る。都市オブジェクトを区切る場所は、地物型ごとに標準製品仕様書に示されている。表5-5に、地物型ごとに定義された、都市オブジェクトを区切る場所を一覧で示す。 |

**表 5-5 — 都市オブジェクトの区切り**

| 地物型 | 都市オブジェクトの区切り |
| --- | --- |
| 建築物 | ― |
| 交通（道路） | 交差部（四差路、多差路及び三差路）、道路構造の変化点、位置正確度や取得方法の変化点で区切る。 |
| 交通（鉄道） | 路線、軌道の分合流、市区町村界、位置正確度や取得方法の変化点で区切る。 |
| 交通（徒歩道） | 交差部、道路構造の変化点、位置正確度や取得方法の変化点で区切る。 |
| 交通（広場） | 位置正確度や取得方法の変化点で区切る。 |
| 交通（航路） | 航路が交差する部分で区切る。 |
| 土地利用 | ― |
| 災害リスク | 災害リスク（浸水）はメッシュの境界で区切る。 |
| 都市計画決定情報 | 都市計画区域、準都市計画区域及び区域区分は区域の境界に加えて市区町村界により区切る。 |
| 橋梁 | 高架橋のように延長の長い橋梁は、管理区間及び上部工の境界（伸縮装置の設置部）で区切ることができる。 |
| トンネル | 高速道路等に存在する延長の長いトンネルは、管理区間及び覆工スパンの境界で区切ることができる。 |
| その他の構造物 | 堤防のように延長が長く、構造上の切れ目なく続く場合は、管理区間及び市区町村界で区切ることができる。 |
| 都市設備 | ― |
| 地下埋設物 | ― |
| 地下街 | ― |
| 植生 | ― |
| 地形 | メッシュの境界で区切る。 |
| 水部 | メッシュの境界で区切る。 |
| 区域 | ― |

**表 5-6 — 24: LOD毎の幾何品質情報の記録**

| ID | `/att/quality/3` |
| --- | --- |
| 主題 | 標準作業手順 |
| 分類 | 要件分類4: 3D都市モデル作成手順と品質評価の留意事項 |
| 条文 | 幾何オブジェクトに関する品質情報を、LOD毎に記録する。全ての都市オブジェクトは、データの品質に関する情報を記録するデータ品質属性（uro:DataQualityAttribute）を作成しなければならない。このデータ品質属性は、幾何オブジェクトに関する品質として以下の属性をもつ。LOD別の原典資料の種類LOD別のアピアランスに使用した画像の種類LOD1の立ち上げに使用した高さ（LOD1の幾何オブジェクトを一律の高さで押し出した立体として表現する場合）LODの詳細な区分（LOD2.0やLOD2.1のように、LODを細分する場合）幾何オブジェクトを作成する場合は、都市オブジェクトごとに、これらの情報を記録すること。 |

## 5.2.3 実施すべき品質評価

「幾何オブジェクトの作成」では、主として位置正確度や図形の論理的な正しさに関する品質評価を行う。また、幾何オブジェクトを作成する際に、地物型を区分することが多いため、完全性（地物の漏れ、過剰）や主題正確度（分類の正しさ）について品質評価を行う。

幾何オブジェクトを作成する際、作成済みの幾何オブジェクトを加工して新たな幾何オブジェクトを作成する場合がある。例えば、LOD1の幾何オブジェクトを作成するためにLOD0の幾何オブジェクトを使用したり、LOD2の幾何オブジェクトを作成するためにLOD1の幾何オブジェクトを使用したりすることが該当する。これは、新たに作成しようとする幾何オブジェクトに要求される位置正確度が、作成済みの幾何オブジェクトの位置正確度と同じ又は低い場合にのみ適用可能な手法である。

既に作成済みの幾何オブジェクトを、座標の編集をすることなくそのまま使用した場合には、当該幾何オブジェクトについては、位置正確度の品質評価が実施済みであるとして、位置正確度の品質評価を行わなくてもよい。例えば、LOD3の建築物を作成する際に、LOD2として作成済みの建築物の幾何オブジェクトを利用し、この座標を編集することなく、開口部の幾何オブジェクトのみを追加することが想定される。LOD2の幾何オブジェクトが既に品質評価を実施されている場合には、この幾何オブジェクトに対してはLOD3としての位置正確度の品質評価を行う必要はなく、新規に追加した開口部のみを品質評価の対象とすればよい。ただし、LOD2の幾何オブジェクトを構成する境界面を編集して軒裏の表現が必要となるLOD3の幾何オブジェクトを新たに作成した場合（例：1m以上の軒裏をもつ建築物のLOD3.1を、LOD2を使用して作成する場合）には、LOD3に求められる位置正確度の品質評価を行うこと。

![Image](images/toc4_img008.png)

「幾何オブジェクトの作成」において実施すべき品質評価を以下に示す。品質要素ごとに分類された各番号は、標準製品仕様書に定義する品質要求及び評価手順の識別子である。

- 完全性：C02,C03,C07,C08,C-bldg-01,C-bldg-02,C-bldg-03,C-bldg-04
- 論理一貫性：L07,L08,L09,L11,L12,L13,L14,L15,L16,L17,L18,L-bldg-01,L-bldg-02,L-bldg-03,L-bldg-07,L-bldg-08,L-bldg-09,L-bldg-10,L-bldg-11,L-bldg-12,L-bldg-13,L-frn-01,L-frn-02,L-tran-01,L-tran-02,L-tran-03,
- 位置正確度：P01,P02,P03,P04,P05,P06,P07,P08,P-dem-01
- 主題正確度：T-bldg-01,T-bldg-2

なお、拡張製品仕様書において、地物型等の追加を行ったり、標準製品仕様書に定める品質要求に追加又は変更を行ったりした場合には、それに対応する品質評価を行う必要がある。幾何オブジェクトを作成した段階で実施することが効率的な品質要求を以下に示す。

- 完全性（地物の過不足）
- 論理一貫性（幾何オブジェクトの論理的な正しさ）
- 位置正確度
- 主題正確度（地物の区分）

## 5.3 属性追加と品質評価

## 5.3.1 属性の追加

地物型に定義された主題属性及び時間属性を、幾何オブジェクトの属性として追加する。追加すべき主題属性及び時間属性は、第1章において決定した各都市の製品仕様に従う。

- 【手順】
- 手順1．原典資料に含まれる、作成した幾何オブジェクトに対応する値を特定する。
- 手順2．幾何オブジェクトの属性として特定した値を記述する。
- 手順3．品質評価を実施する。

## 5.3.2 作業上の留意事項

建築物等の都市オブジェクトの作成においては、附属書Cから附属書Uに示す妥当な都市オブジェクトの要件を満たすこと。
以下に、本作業で生じうるエラーに対する留意事項を示す。

**表 5-7 — 25: データ型の整合性**

| ID | `/att/quality/4` |
| --- | --- |
| 主題 | 標準作業手順 |
| 分類 | 要件分類4: 3D都市モデル作成手順と品質評価の留意事項 |
| 条文 | 製品仕様では、データの値の型が厳密に定義されている。そのため、原典資料により得られた情報と型が一致しない場合には、定義された型に合わせて修正する。日付の記述には、JIS X0301により定義された、拡張形式による暦日付の完全表記（YYYY-MM-DD）を使用する。正しい記述例： 2020-04-01誤った記述例：令和2年4月1日（西暦で記載しなければならない）  2020-04（年、月、日の組み合わせでなければならない）  2020/04/01（年と月、月と日はハイフンでつながなければならない） 不明（不明な場合は、0001-01-01を入れる） 令和2年4月（年月のみ分かる場合は、YYYY-MM-01とするため、2020-04-01とする）コード型の属性におけるコードの記述は、コードリストに示されたコードと一致させる。原典資料では、文字列として入力されていることが多いため、半角・全角の区分が混在している場合や、定義されたコード以外が入力されている場合がある。あらかじめ原典資料に含まれるコードを抽出し、作成したコードリストと照合させ、必要に応じてコードの変換又はコードリストへの反映を行う。単位付き数値型の属性の値を記述する際は、原典資料の単位と拡張製品仕様書において指定した単位を確認する。原典資料で使用されている数値の単位と拡張製品仕様書で使用する単位が異なる場合は、数値の変換が必要となる。 |

**表 5-8 — 26: 不整合の対処方法**

| ID | `/att/quality/5` |
| --- | --- |
| 主題 | 標準作業手順 |
| 分類 | 要件分類4: 3D都市モデル作成手順と品質評価の留意事項 |
| 条文 | 幾何オブジェクトは存在するが、記述すべき属性が既存資料等に無い、あるいは記述すべき属性が既存資料等に存在するが、該当する場所に幾何オブジェクトが無い、等の不整合が発見された場合には、3.4において決定した対処方法に従う。 |

**表 5-9 — 27: 建築物の属性「uro:city」の必須記述**

| ID | `/att/quality/6` |
| --- | --- |
| 主題 | 標準作業手順 |
| 分類 | 要件分類4: 3D都市モデル作成手順と品質評価の留意事項 |
| 条文 | 建築物の属性uro:city（市区町村）は、必ず記述する。都市ごとに建築物の表示／非表示を切り替える等、建築物の大まかな位置を把握するために使用されるため、uro:cityは必ずデータを作成する。政令指定都市の場合は、「区」に該当するコードを選択する。 |

**表 5-10 — 28: 建築物の用途列挙**

| ID | `/att/quality/7` |
| --- | --- |
| 主題 | 標準作業手順 |
| 分類 | 要件分類4: 3D都市モデル作成手順と品質評価の留意事項 |
| 条文 | 複合的な用途を有する建築物について、それぞれの用途を記述したい場合にはbldg: usageを複数列挙する。複数の用途を列挙する場合は、主たる用途を最初に記述する。 |

**表 5-11 — 29: コード型属性の追加**

| ID | `/att/quality/8` |
| --- | --- |
| 主題 | 標準作業手順 |
| 分類 | 要件分類4: 3D都市モデル作成手順と品質評価の留意事項 |
| 条文 | 建築物以外の地物型にコード型の属性を追加する場合には、汎用属性セットにより、コードだけではなく、参照するコードリストの所在を対として追加する。建築物以外の地物に属性を追加する仕組みとして、汎用属性（gen:genericAttribute）がある。しかしながら、汎用属性には、文字列型、数値型等があるもののコード型はない。そこで、コード型の属性を追加する場合には、汎用属性セットにより、コードだけではなく、参照するコードリストの所在を対として追加する。汎用属性は、コードを記述する文字列型の汎用属性（name=”code”とする）と、コードが参照するコードリストの所在を記述する文字列型の汎用属性（name=”codeSpace”）を作成し、これらを汎用属性セットにより束ねる。コードに対応するコードリストを必ず作成する。 |

**表 5-12 — 30: 不明値の指定方法**

| ID | `/att/quality/9` |
| --- | --- |
| 主題 | 標準作業手順 |
| 分類 | 要件分類4: 3D都市モデル作成手順と品質評価の留意事項 |
| 条文 | 属性の値が不明である場合は、属性の型ごとに指定された不明を表す値を入力する。属性の値が不明である場合は、属性の型ごとに指定された不明を表す値（表5-13）を入力する。ただし、コード値（gml:CodeType）及び真偽値（xs:boolean）については、以下とする。真偽値（xs:boolean）は、はtrue又はfalseのみを値として取るため、属性を省略する。コード値（gml:CodeType）は、不明を表すコードが定義されている場合はこれを入力し、不明を表すコードが定義されていない場合は、属性を省略する。ただし、不明値の入力が必須の場合は、指定のコードリストを拡張し、不明値を示すコードを追加することを基本とする。 |

**表 5-13 — 属性値が不明な場合の対応**

| 属性の型 | 不明な場合の対応 |
| --- | --- |
| xs:string | Nullと入力する。（半角英文字） |
| xs:integer | -9999と入力する。 |
| xs:double | -9999と入力する。 |
| xs:date | 年月日が分からない場合は、0001-01-01と入力する。年のみ分かる場合はYYYY-01-01とし、年月のみ分かる場合はYYYY-MM-01とする。 |
| xs:boolean | 属性を省略する。 |
| xs:gYear | 0001と入力する。 |
| xs:nonNegativeInteger | 9999と入力する。 |
| gml:MeasureType, gml:LengthType | 値は-9999とし、単位は属性ごとに指定された単位を入力する。 |
| gml:MeatureOrNullListType | Null値の定義域にunknownを指定する。 |
| xs:anyURI | Nullと入力する。（半角英文字） |

　

注記5.3.2の注記必須ではない属性は省略できる。そのため、属性値が不明な場合は属性を省略することもできる。

ただし、属性を省略すると、不明だからデータがないのか、データが漏れている（エラー）なのかを区別できない。そこで、作成対象とするデータについては、属性値が不明な場合は表5-13に示す不明を表す値を入力する。

**表 5-14 — 31: NULL値と不明値の変換**

| ID | `/att/quality/10` |
| --- | --- |
| 主題 | 標準作業手順 |
| 分類 | 要件分類4: 3D都市モデル作成手順と品質評価の留意事項 |
| 条文 | 原典資料におけるNULL値や不明値の取り扱いに注意する。原典資料がGISデータである場合、GIS独自のデータ形式の仕様により、NULL値の取り扱いが異なる。例えば、数値型の属性についてデータが無い場合に、「0」が入力されていることがある。この「0」はデータが無いことを意味するため、NULL値として取り扱うべきである。値が不明な場合に、各原典資料の定義に従い「不明」や「9999」といった不明であることを示す文字列又は数値が入力されている。これらの不明値は、標準製品仕様書のデータ型やコードリストの定義に従い変換すること。例えば、xs:gYear型（年）の値が不明な場合に、原典資料では「9999」となっていたとする。標準製品仕様書では、xs:gYear型（年）の値が不明な場合には、「0001」とするよう定められている。よって、「9999」は「0001」に変換しなくてはならない。 |

**表 5-15 — 32: 主題属性の品質記録**

| ID | `/att/quality/11` |
| --- | --- |
| 主題 | 標準作業手順 |
| 分類 | 要件分類4: 3D都市モデル作成手順と品質評価の留意事項 |
| 条文 | 主題属性の作成に関する品質情報を、都市オブジェクト毎に記録する。全ての都市オブジェクトは、データの品質に関する情報を記録するデータ品質属性（uro:DataQualityAttribute）を作成しなければならない。このデータ品質属性は、主題属性に関する品質として以下の属性をもつ。主題属性に使用した原典資料の種類都市オブジェクトごとに、これらの情報を記録すること。 |

## 5.3.3 実施すべき品質評価

「属性の追加」では、主として主題属性に関する品質評価を行う。属性の型は正しいか、定義域を満たしているか（論理一貫性）、正しい属性値が格納されているか（主題正確度）について評価する。
 「属性の追加」において実施すべき品質評価を以下に示す。 
品質要素ごとに分類された各番号は、標準製品仕様書に定義する品質要求及び評価手順の識別子である。

- 完全性：C-bldg-01
- 論理一貫性：L04,L-bldg-03,L-bldg-04,L-bldg-05
- 位置正確度：―
- 主題正確度：T01,T02

標準製品仕様書の品質要求に追加又は変更を行った場合には、論理一貫性及び主題正確度についての品質評価を実施すること。

## 5.4 データ出力と品質評価

## 5.4.1 データ出力

前項までで作成した3D都市モデルを、製品仕様に示された符号化仕様に従うデータに変換する。

- 【手順】
- 手順1．指定されたファイル単位に分割する。
標準製品仕様書で地物型ごとに指定されたファイル単位（ 6.4.2）に従い、分割する。分割は、メッシュコードに紐づく空間範囲ごとに実施する。ただし、空間範囲の境界線上に存在する地物は区切らず、それぞれのメッシュに平面投影した形状が含まれる面積の割合を算出し、この割合が最も大きいメッシュに対応するファイルに含む。m2で面積を計算し、小数点2桁（3桁目で四捨五入）で比較する。面積が同じ場合はメッシュ番号の小さい方とする。
- 手順2．分割したファイル単位にデータを変換・出力する。
符号化仕様に定義されたタグ及びタグの構造（階層、出現順序、データ型、出現回数等）に従い、プログラム等により分割したデータをCityGML及びi-URによるGML形式に変換する。i-UR及びCityGMLに定義された地物型等には、それぞれi-UR及びCityGMLで推奨された接頭辞を使用する。 
出力においては、成果品となる3D都市モデルの構造（5.4に示すファイル名やフォルダ構成）を考慮すること。 
 CityGML及びi-URの符号化仕様は以下より取得できる。CityGML：[http://schemas.opengis.net/citygml/](http://schemas.opengis.net/citygml/)i-UR：[https://www.geospatial.jp/iur/schemas/uro/3.2/urbanObject.xsd](https://www.geospatial.jp/iur/schemas/uro/3.2/urbanObject.xsd)[https://www.geospatial.jp/iur/schemas/urf/3.2/urbanFunction.xsd](https://www.geospatial.jp/iur/schemas/urf/3.2/urbanFunction.xsd)なお、符号化仕様は最新のものであることをversion属性により確認すること。version属性は、符号化仕様内のxs:schemaタグに記載されている（以下のフラグメントの太字部分）。図5-7
- 手順3．コード型に対応するコードリストをXML形式に変換・出力する。XMLの形式は、GML 3.1.1 simple dictionary profileを使用する。
 GML 3.1.1 simple dictionary profileは、もともとは辞書として利用されることを想定したXML形式であり、名前（gml:name）とその説明（gml:description）の対の集まりから構成される。CityGMLでは、コードリストの符号化仕様としてこのGML 3.1.1 simple dictionary profileを使用していることから、標準製品仕様においてもコードリストの符号化仕様としてGML 3.1.1 simple dictionary profileを採用する。 
 GML 3.1.1 simple dictionary profileに従ったXML形式のコードリスト例を以下に示す。図5-8gml:Dictionaryのgml:idは、`[接頭辞]_[UUID]`とする。`[接頭辞]`は、clとする。`[UUID]`は、Universally Unique Identifierとする。gml:nameには、当該3D都市モデルにおけるコードリストを識別する名称として、地物型名と属性名との組み合わせとする。地物型名と属性名とは_（アンダースコア）でつなぐ。コードとその説明を、gml:Definitionにより対として記述する。gml:Definitionの子要素となるgml:descriptionには説明を、gml:nameにはコードを示す。標準製品仕様書に定義されたコードリストのXMLは以下より取得できる。
[https://www.geospatial.jp/iur/codelists](https://www.geospatial.jp/iur/codelists)
- 手順4．品質評価を実施する。論理一貫性（L03）の品質評価は、拡張製品仕様書において作成対象とした地物及び属性に対して行うこと。

## 5.4.2 作業上の留意事項

出力したデータについても、附属書B及び附属書Uに示す要件を満たさなければならない。以下に、本作業で生じうるエラーに対する留意事項を示す。

**表 5-16 — 33: 要素への接頭辞付与**

| ID | `/att/quality/12` |
| --- | --- |
| 主題 | 標準作業手順 |
| 分類 | 要件分類4: 3D都市モデル作成手順と品質評価の留意事項 |
| 条文 | 全ての要素に必ず接頭辞を付ける。複数の名前空間に定義された符号化仕様を使用しているため、混乱を生じないよう、全ての要素に接頭辞を付ける。 |

**表 5-17 — 34: `gml:id`の付与ルール**

| ID | `/att/quality/13` |
| --- | --- |
| 主題 | 標準作業手順 |
| 分類 | 要件分類4: 3D都市モデル作成手順と品質評価の留意事項 |
| 条文 |  gml:idの付与ルールに従う。gml:idは、データ集合内でオブジェクトを識別するためのIDである。3D都市モデルでは、このgml:idに `[接頭辞]_[UUID]`を使用する。`[接頭辞]`は、製品仕様書に示す、CityGML及びi-URの各パッケージに与えられた接頭辞（表5-18）とする。また、`[UUID]`は、Universally Unique Identifierとする。 |

**表 5-18 — 接頭辞**

| 応用スキーマ | ← | 接頭辞 |
| --- | --- | --- |
| 建築物モデル | ← | bldg |
| 交通（道路）モデル | ← | tran |
| 交通（鉄道）モデル | ← | rwy |
| 交通（徒歩道）モデル | ← | trk |
| 交通（広場）モデル | ← | squr |
| 交通（航路）モデル | ← | wwy |
| 土地利用モデル | ← | luse |
| 災害リスク（浸水）モデル | 洪水浸水想定区域 | fld |
| ↑ | 津波浸水想定 | tnm |
| ↑ | 高潮浸水想定区域 | htd |
| ↑ | 内水浸水想定区域 | ifld |
| ↑ | ため池ハザードマップ | rfld |
| 災害リスク（土砂災害）モデル | 土砂災害警戒区域 | lsld |
| 都市計画決定情報モデル | ← | urf |
| 橋梁モデル | ← | brid |
| トンネルモデル | ← | tun |
| その他の構造物モデル | ← | cons |
| 都市設備モデル | ← | frn |
| 地下埋設物モデル | ← | unf |
| 地下街モデル | ← | ubld |
| 植生モデル | ← | veg |
| 地形モデル | ← | dem |
| 水部モデル | ← | wtr |
| 区域モデル | ← | area |
| 汎用都市オブジェクト | ← | gen |
| アピアランスモデル | ← | app |
| 拡張製品仕様書で追加した地物（ただし、urf:Zoneを継承する地物を除く） | ← | ext |

**表 5-19 — 35: XMLタグの出現順序**

| ID | `/att/quality/14` |
| --- | --- |
| 主題 | 標準作業手順 |
| 分類 | 要件分類4: 3D都市モデル作成手順と品質評価の留意事項 |
| 条文 |  XML文書におけるタグの出現順序は、XMLSchemaにおいて定められた順序とする。XMLで出現するタグは、あらかじめXMLSchemaによりその順序が決まっている。具体的には以下の順序で出現することが基本となる。これらの順序を守らない場合、論理一貫性に不適合となる。 1）gml:*  2）core:*  3）gen:*  4）bldg:*、tran:*等CityGMLの地物型で定義された属性・関連役割 5）uro:*、urf:*等i-URで定義された属性・関連役割UMLクラス図で記述された属性や関連役割がXML文書のタグとして出現する。UMLクラス図で記述された属性と関連役割には順序の概念がない。一方、XMLSchemaでは順序をもつ。そのため、UMLクラス図の記述だけでは、XMLSchemaでの出現順序が分からない。データ出力時には、XMLSchemaにおいて出現順序を確認し、定められた順序となるよう注意すること。ただし、ポイントクラウドモデルはcore:_CityObjectに拡張を行っているため、ポイントクラウドと関連付けた都市オブジェクトのインスタンスに関してはcore:_CityObjectを継承する各都市オブジェクトに定義された属性（例：bldg:class）などよりも前にuro:pointCloudのタグが出現する。また、植生モデルは、uro:を接頭辞とする属性及び関連役割が、CityGMLで定義された接頭辞veg:よりも前に出現してよい。接頭辞veg:よりも前に出現してよいタグは、veg:SolitaryVegetationObject及びveg:PlantCoverの上位の地物型である、veg:_VegetationObjectに拡張された属性及び関連役割（uro:vegDataQualityAttribute、uro:vegFacilityIdAttribute、uro:vegFacilityTypeAttribute、uro:vegFacilityAttribute、uro:vegKeyValuePairAttribute及びuro:vegDmAttribute）である。 |

**表 5-20 — 36: 主題属性には「不明」値も含めて出力**

| ID | `/att/quality/15` |
| --- | --- |
| 主題 | 標準作業手順 |
| 分類 | 要件分類4: 3D都市モデル作成手順と品質評価の留意事項 |
| 条文 | 作成対象となる主題属性は、「不明」値も含めて出力する。一つの応用スキーマの単位で作成対象とする主題属性を決定した場合は、原典資料に基づき「不明」の値も含めて全ての都市オブジェクトに必ずタグを作成する。「不明」値は、基本となるデータ型ごとに指定された不明を表す値（留意事項30参照）を使用すること。CityGML及びi-URで定義された属性の多くは多重度が`[0..1]`であり、省略可能である。しかし、作成対象であるデータについてタグを省略すると、データがないのか、不明なのか、又はエラーで漏れているのかがわからなくなるため、不明であることを明示する必要がある。例えば、「都市計画基礎調査（建物利用現況）」を原典資料として「建築物モデル」の主題属性「bldg:usage」を作成することとした場合、原典資料によって、「不明」の場合に不明値のコードが入力されている場合と、値が空となっている場合（調査対象ではあるが値を入れていない場合）が混在する。後者のような場合には、作業機関の作業によって、「不明」の範囲を特定し、主題属性「bldg:usage」には不明を表すコード値（461）を出力する。補足：「洪水浸水想定区域図」を原典資料として、「建築物モデル」の主題属性「uro:BuildingRiverFloodingRiskAttribute」を作成することとするような場合、原典資料の範囲外の値は存在しない。このような場合は、「不明」ではなく「不存在」なので、値を出力する必要はない。 |

**表 5-21 — 37: 作成対象外のタグは作成しない**

| ID | `/att/quality/16` |
| --- | --- |
| 主題 | 標準作業手順 |
| 分類 | 要件分類4: 3D都市モデル作成手順と品質評価の留意事項 |
| 条文 | 作成対象ではない地物型等のタグは作成しない（空タグを作成しない）。i-UR やCityGMLには様々な地物型や属性が定義されている。作成対象としない地物型及び属性は、空タグ（値を入れないタグ）を作成しない。 |

**表 5-22 — 38: 単位付き数値には必ずuom属性を指定**

| ID | `/att/quality/17` |
| --- | --- |
| 主題 | 標準作業手順 |
| 分類 | 要件分類4: 3D都市モデル作成手順と品質評価の留意事項 |
| 条文 | 単位付き数値型の属性には、かならずuom属性により、単位を指定する。単位付き数値とは、50.0m, 50haのように、数値に単位を付する属性の型である。原典資料では単位が省略されている場合があるが、符号化仕様において単位付き数値で記述することが指定されている場合には、単位を付与する。例1 — 記述例標準製品仕様書では原則として、長さの単位は“メートル”、面積の単位は“平方メートル”又は“ヘクタール”、時間の単位は“時間”を採用している。uom属性にはそれぞれ“m”、”m2”、”ha”、”hour”を記述する。 |

**表 5-23 — 39: コードリストとcodeSpaceの指定**

| ID | `/att/quality/18` |
| --- | --- |
| 主題 | 標準作業手順 |
| 分類 | 要件分類4: 3D都市モデル作成手順と品質評価の留意事項 |
| 条文 | コードは、あらかじめ用意されたコードリストに列記されたコードから一つを選択し、値として記述する。このとき、用意されたコードリストの所在をcodeSpace属性に記述する。コードリストは3D都市モデルのファイルからの相対パスによる記述とする。相対パスは、成果品のフォルダ構成に従う（第6章参照）。例2 — 記述例：相対パスによるcodeSpaceの指定の例 |

**表 5-24 — 40: コード型属性の汎用属性セット**

| ID | `/att/quality/19` |
| --- | --- |
| 主題 | 標準作業手順 |
| 分類 | 要件分類4: 3D都市モデル作成手順と品質評価の留意事項 |
| 条文 | 汎用属性セットを用いてコード型の属性を追加した場合には、コードが参照するコードリストの所在を記述する文字列型の汎用属性（name=“codeSpace”）とコードを記述する文字列型の汎用属性（name=“code”）との対として符号化する。例3 — 記述例：都市設備（CityFurniture）に追加する場合例4 — 記述例：汎用都市オブジェクト（GenericCityObject）に追加する場合コードリストの所在の記述は、gml:CodeTypeを使用したcodeSpace属性による指定と同様とする。 |

**表 5-25 — 41: データ出力時の変換エラーに注意**

| ID | `/att/quality/20` |
| --- | --- |
| 主題 | 標準作業手順 |
| 分類 | 要件分類4: 3D都市モデル作成手順と品質評価の留意事項 |
| 条文 | データ出力時における変換エラーに留意する。幾何オブジェクトの作成や、属性の追加において正しくデータが作成されているにも関わらず、符号化する際の変換プログラムの誤りにより、エラーが生じることに留意すること。特に、以下の事項を確認する。変換元となる空間参照系と、変換先となる空間参照系が正しく設定されているか。コード型の主題属性について、原典資料独自のコードから指定したコードに正しくマッピングされているか。また、正しいコードリストを参照しているか。単位付き数値型の属性が、指定した単位に変換されているか。不要なNULL値が出力されていないか。また、不要な空タグが出力されていないか。座標列は、緯度、経度、標高の順列となっているか（経度、緯度、標高の順列は誤り）。面を構成する座標列の向きは左回りになっているか（右回りは誤り）。 |

**表 5-26 — 42: i-URの符号化仕様は相対パスで指定**

| ID | `/att/quality/21` |
| --- | --- |
| 主題 | 標準作業手順 |
| 分類 | 要件分類4: 3D都市モデル作成手順と品質評価の留意事項 |
| 条文 |  i-URの符号化仕様は相対パスによりschemaLocationを指定する。CityGML形式に出力したファイルのschemaLocationの指定は、3D都市モデルの成果品に含めるi-URの符号化仕様のファイルへの相対パスとする。地物型又はモジュールごとに分けられた3D都市モデルの成果品を格納するフォルダ（例：bldg,tran）の直下に格納した3D都市モデルファイルの場合、schemaLocationとして記述すべき符号化仕様への相対パスは以下となる。`urbanObject.xsdへの相対パス：`../../schemas/iur/uro/3.2/urbanObject.xsd`urbanFunction.xsdへの相対パス：`../../schemas/iur/uro/3.2/urbanFunction.xsd |

**表 5-27 — 43: 部分更新時のデータ漏れ・重複確認**

| ID | `/att/quality/22` |
| --- | --- |
| 主題 | 標準作業手順 |
| 分類 | 要件分類4: 3D都市モデル作成手順と品質評価の留意事項 |
| 条文 | 部分更新となる場合は、統合したデータに漏れや重複が無いことを確認する。既に3D都市モデルが存在しており、その一部を更新する場合は、更新した3D都市モデルと更新していない3D都市モデルとを統合し、一式とする必要がある。そのため、統合した際にデータの漏れや重複が無いことを確認する。 |

**表 5-28 — 44: 変換プログラムのデフォルト値確認**

| ID | `/att/quality/23` |
| --- | --- |
| 主題 | 標準作業手順 |
| 分類 | 要件分類4: 3D都市モデル作成手順と品質評価の留意事項 |
| 条文 | 変換プログラムのデフォルト設定に注意する。データ出力に使用する変換プログラムによっては、必須となる属性等にデフォルト値が用意されている場合がある。デフォルト値が標準製品仕様書の指定する値と異なる場合もあるため、設定を確認する。app:Appearance の属性app:themeの値を標準製品仕様書では、“rgbTexture”と指定している。データ変換ツールとして一般的に使用されている商用ツールであるFMEを使って変換する場合、この値の指定をしなければ、デフォルトで“FMETheme”と入力される。 |

**表 5-29 — 45: LOD別の地物は同一ファイルに出力**

| ID | `/att/quality/24` |
| --- | --- |
| 主題 | 標準作業手順 |
| 分類 | 要件分類4: 3D都市モデル作成手順と品質評価の留意事項 |
| 条文 | 一つの都市オブジェクトを異なるLODで記述した場合、一つの地物インスタンスとして同じファイルに出力することを基本とする。3D都市モデルの各地物型には、LOD0からLOD4までの複数の空間属性が定義されている。これにより一つの都市オブジェクトを詳細度の異なる複数の幾何オブジェクトで表現することができる。このとき、同じ都市オブジェクトについてのLODが異なる複数の幾何オブジェクトは、同一の地物インスタンスに含まれる各LODの幾何オブジェクトとして同じファイルに出力することを基本とする。ただし、地形モデル（LOD3）の場合は、ファイル名のオプション（lod3）を用いてファイルを分けてもよい。これは、地物の単位が基準地域メッシュであることから、同一の地物インスタンスに複数のLODを格納することでデータ量が膨大となり、操作性が低下することを避けることを目的としている。 |

## 5.4.3 実施すべき品質評価

データ出力では、主として出力されたデータが符号化仕様に適合しているか（書式一貫性、概念一貫性）の評価を行う。また、完全性として、データ作成に使用したツールの内部形式で記述されたデータが、漏れや過剰なく出力されていることを確認する。
データ出力において実施すべき品質評価を以下に示す。 
品質要素ごとに分類された各番号は、標準製品仕様書に定義する品質要求及び評価手順の識別子である。

- 完全性：C01,C02,C03,C05,C06
- 論理一貫性：L01,L02,L03,L05,L06,L07,L10,L15,L-bldg-06,L-bldg-07,L-bldg-08,L-bldg-09,L-bldg-10,L-bldg-11,L-frn-01,L-tran-03
- 位置正確度：―
- 主題正確度：T03,T-bldg-02

標準製品仕様書の品質要求に追加又は変更を行った場合には、完全性、論理一貫性及び主題正確度について、出力したデータに対して必要となる品質評価を実施する。

**表 5-30 — 46: 全ての都市オブジェクトにデータ品質属性を付与**

| ID | `/att/quality/25` |
| --- | --- |
| 主題 | 標準作業手順 |
| 分類 | 要件分類4: 3D都市モデル作成手順と品質評価の留意事項 |
| 条文 | 3D都市モデルに含まれる全ての都市オブジェクトに、データ品質属性（uro:DataQualityAttribute）を作成する。作成対象とするLODごとに、幾何オブジェクトの作成に使用した原典資料の種類を記述すること。アピアランスを作成した場合には、対象とするLODごとに使用した原典資料の種類を記述すること。主題属性を作成した場合は、使用した原典資料の種類を記述すること。複数種類の原典資料を使用した場合には、それぞれ記述すること。作成対象とするLODを作成しなかった都市オブジェクトについても、「未作成（コード：999）」であることを示さなければならない。 |

**表 5-31 — 47: 公共測量成果を用いた場合の品質属性作成**

| ID | `/att/quality/26` |
| --- | --- |
| 主題 | 標準作業手順 |
| 分類 | 要件分類4: 3D都市モデル作成手順と品質評価の留意事項 |
| 条文 | 公共測量成果又は基本測量成果を使用する場合は、公共測量品質属性（uro:PublicSurveyDataQualityAttribute）を必ず作成する。公共測量成果又は基本測量成果のみを使用して幾何オブジェクトを作成した場合は、公共測量品質属性（uro:PublicSurveyDataQualityAttribute）を用いて、使用した公共測量成果又は基本測量成果の種類をLODごとに記述すること。ただし、公共測量成果又は基本測量成果とそれ以外の資料を組み合わせによる作成や推定による補完は、公共測量成果とはならないため、公共測量品質属性（uro:PublicSurveyDataQualityAttribute）を作成しない。作成した幾何オブジェクトが公共測量成果となる場合にのみ作成する。 |

