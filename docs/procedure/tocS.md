# 附属書S 妥当な地形オブジェクト

## 附属書S （規定） 妥当な地形オブジェクト

## S.1 概要

本付属書では、「3D都市モデル標準製品仕様書」（以下、「標準製品仕様書」という）に適合したデータ製品について、「地形モデル」に従って作成されるべき都市オブジェクト（以下、「地形オブジェクト」という）が満たすべき要件と、妥当な地形オブジェクトを作成するための標準的な作業手順を示す。

**表 S-1 — S-1: 妥当な地形オブジェクト**

| ID | `/req/dem` |
| --- | --- |
| 対象の種類 | 妥当な地形オブジェクトの要件 |
| 説明 | 地形の説明とLODの要件 |
| 規定 | 要件S-1: 地形記述のLOD対応条件要件S-2: 地形のLOD0形状定義要件S-3: 地形のLOD1形状定義要件S-4: 地形のLOD2形状定義要件S-5: 地形のLOD3形状定義 |

## S.2 地形の記述とLOD

## S.2.1 地形モデル

地形とは、地表の起伏の状態をいう。[[付録７ 公共測量標準図式](https://www.gsi.go.jp/gijyutukanri/gijyutukanri41018.html)]

地形の記述には、CityGMLのReliefモジュールに定義された、dem:ReliefFeatureを使用する。
 CityGMLでは、地形の表現として、不規則三角網（TINRelief）による表現や標高点の集まり（MassPointRelief）による表現、等高線等の高さをもつ線の集まり（BreaklineRelief）による表現など、複数の表現方法について、それぞれ必要な地物型を用意している。

標準製品仕様書では、地形の表現に必要な地物型等をCityGML及びi-URより抽出し、LODごとに、含むべき地物型、各地物型の空間属性の型、取得基準、取得方法及び補足を定めた「地形モデル」を定義する。

地形モデルのLODは、LOD0からLOD3までを対象とする。地形モデル（LOD0）は公共測量標準図式に従った地形の表現である。地形モデル（LOD1）から地形モデル（LOD3）までは、地形の作成に使用する原典資料の点密度又は標高点格子間隔により決定する。

![Image](images/tocS_img001.png)

## S.2.2 使用可能な地物型とLOD

地形モデルは、LODごとに使用すべき地物型やその空間属性を定めている。

**表 S-2 — S-1: 地形記述のLOD対応条件**

| ID | `/req/dem/1` |
| --- | --- |
| 主題 | 妥当な地形データセットの要件 |
| 分類 | 要件分類S-1: 妥当な地形オブジェクト |
| 条文 | 地形の記述には、指定されたLODに対応する地物型及び空間属性を使用する。 |

地形の記述には、CityGMLのReliefモジュールに定義されたdem:ReliefFeatureを使用する。

地形はその表現方法に応じて地形要素（dem:_ReliefComponent）を選択する。標準製品仕様書では、地形要素として、dem:TinRelief、dem:MassPointRlief及びdem:BreaklineReliefを地形モデルに含めている。地形の表現では、これら三つの地形要素から一つを選択し、その集まりとして地形を表現する。

地形の各LODにおいて使用可能な地物型とその空間属性を表S-3に示す。

**表 S-3 — 地形モデルの記述に使用する地物型と空間属性**

| 地物型 | 空間属性 | LOD0 | LOD1 | LOD2 | LOD3 | 適用 |
| --- | --- | --- | --- | --- | --- | --- |
| dem:ReliefFeature |  | ● | ● | ● | ● | dem:ReliefFeatureを作成する場合は、dem:BreaklineRelief、dem:TINRelief又はdem:ReliefFeatureのいずれかを必須とする |
| dem:BreaklineRelief |  | ■ |  |  |  |  |
| ↑ | dem:ridgeOrValleyLines | ■ |  |  |  | ↑ |
| dem:TINRelief |  | ■ | ■ | ■ | ■ | LOD1、LOD2及びLOD3では、dem:TINReliefを基本とする。 |
| ↑ | dem:tin | ■ | ■ | ■ | ■ | ↑ |
| dem:MassPointRelief |  | ■ | ■ | ■ | ■ | ↑ |
| ↑ | dem:reliefPoints | ■ | ■ | ■ | ■ | ↑ |
| ●：必須■：条件付必須〇：任意（ユースケースに応じて要否を決定してよい） | ← | ← | ← | ← | ← | ← |

3D都市モデルでは、地形モデルにdem:TINReliefを使用することを推奨している。この理由として、点群で扱う場合には、LAS形式など点群に特化したデータフォーマットが別途存在し、地形モデルには主題属性が付与されていないことから、CityGMLを使用して点群を記述する利点があまりないことが挙げられる。地形を連続した面として取り扱えるようにすることを重視し、dem:TINReliefの採用を推奨する。

## S.2.3 地形の空間属性

## S.2.3.1 LOD0

地形モデル（LOD0）では、地形の形状を点、線又は面により表現する。このとき、地形オブジェクトは、地形モデル（LOD0）の定義に従ったものでなければならない。

**表 S-4 — S-2: 地形のLOD0形状定義**

| ID | `/req/dem/2` |
| --- | --- |
| 主題 | 妥当な地形データセットの要件 |
| 分類 | 要件分類S-1: 妥当な地形オブジェクト |
| 条文 | 地形のLOD0の形状は、地形モデル（LOD0）の定義に従う。 |

地形モデル（LOD0）は、公共測量標準図式に従った表現となる。

## S.2.3.2 LOD1

地形モデル（LOD1）では、地形の形状を、高さをもつ三角形の集まり（dem:TINRelief）又は高さをもつ点の集まり（dem:MassPointRelief）として表現する。このとき、地形オブジェクトは、地形モデル（LOD1）の定義に従ったものでなければならない。

**表 S-5 — S-3: 地形のLOD1形状定義**

| ID | `/req/dem/3` |
| --- | --- |
| 主題 | 妥当な地形データセットの要件 |
| 分類 | 要件分類S-1: 妥当な地形オブジェクト |
| 条文 | 地形のLOD1の形状は、地形モデル（LOD1）の定義に従う。 |

## S.2.3.3 LOD2

地形モデル（LOD2）では、地形の形状を、高さをもつ三角形の集まり（dem:TINRelief）又は高さをもつ点の集まり（dem:MassPointRelief）として表現する。このとき、地形オブジェクトは、地形モデル（LOD2）の定義に従ったものでなければならない。

**表 S-6 — S-4: 地形のLOD2形状定義**

| ID | `/req/dem/4` |
| --- | --- |
| 主題 | 妥当な地形データセットの要件 |
| 分類 | 要件分類S-1: 妥当な地形オブジェクト |
| 条文 | 地形のLOD2の形状は、地形モデル（LOD2）の定義に従う。 |

## S.2.3.4 LOD3

地形モデル（LOD3）では、高さをもつ三角形の集まり（dem:TINRelief）又は高さをもつ点の集まり（dem:MassPointRelief）として表現する。このとき、地形オブジェクトは、地形モデル（LOD3）の定義に従ったものでなければならない。

**表 S-7 — S-5: 地形のLOD3形状定義**

| ID | `/req/dem/5` |
| --- | --- |
| 主題 | 妥当な地形データセットの要件 |
| 分類 | 要件分類S-1: 妥当な地形オブジェクト |
| 条文 | 地形のLOD3の形状は、地形モデル（LOD3）の定義に従う。 |

## S.2.4 地形の主題属性

地形の主題属性には、あらかじめCityGML又はGMLにおいて定義された属性（接頭辞dem、gml）がある。また、標準製品仕様書では、i-URにおいて拡張された作成したデータの品質に関する情報を格納するための属性（uro:demDataQualityAttribute）がある。しかし、標準製品仕様書では地形モデルにオープンデータや台帳等の他の原典資料から入手して付与する主題属性を定義していない。

地形モデルに主題属性を付与したい場合は、拡張製品仕様書において汎用属性（gen:_genAttribute）の下位型又は拡張属性（uro:KeyValuePairAttribute）を用いて追加する。

## S.2.4.1 データ品質属性（uro:DataQualityAttribute）

使用した原典資料やそれに基づくデータの品質、また、採用したLODは、データセットのメタデータに記録できる。ただし、データセット全体に対して一つのメタデータを作成することが基本となり、個々の都市オブジェクトの品質を記録することは困難である。

そこで、標準製品仕様書では、個々のデータに対してデータ品質に関する情報を記述するための属性として、「データ品質属性」（uro:DataQualityAttribute）を定義している。データ品質属性は、属性としてデータ作成に使用した原典資料の地図情報レベル、その他原典資料の諸元及び精緻化したLODをもつ。

3D都市モデルに含まれる全ての地形オブジェクトは、このデータ品質属性を必ず作成しなければならない。

## S.3 標準的な作業手順

## S.3.1 幾何オブジェクトの作成

作成に必要となる原典資料を表S-8に示す。

**表 S-8 — 地形モデルの原典資料（幾何オブジェクト）**

|  | 高さを含む座標データ |
| --- | --- |
| LOD0 | 都市計画基本図等のDMデータ |
| LOD1 | 以下のいずれかのデータを一つ以上使用する。基盤地図情報（標高モデル）航空写真航空レーザ点群 |
| LOD2 | 以下のいずれかのデータを一つ以上使用する。航空写真航空レーザ点群 |
| LOD3 | 以下のいずれかのデータを一つ以上使用する。航空写真航空レーザ点群MMS点群地上レーザ点群 |
| 注記S.3.1の注記MMS点群及び地上レーザ点群は広域な範囲を網羅的に実施する航空測量とは異なり、局所的な計測となるため、地形モデルが対象範囲を包括するかを確認する必要がある。対象範囲を包括しない場合は別の測量成果を併用する必要がある。 | ← |

## S.3.1.1 LOD0

## S.3.1.1.1 地形モデル（LOD）の原典資料

**表 S-9**

|  | 高さを含む座標データ |
| --- | --- |
| LOD0 | 都市計画基本図等のDMデータ |

## S.3.1.1.2 地形モデル（LOD0）の作成手順

- DMデータより、地形に該当するデータを抽出する。
地形モデル（LOD0）は、公共測量標準図式に従った表現である。よって、DMデータから、地形に該当する分類コードが付与されたデータを抽出する。 
表S-10に地形に関する公共測量標準図式の分類コードと示す。ただし、都市により独自の分類コードを使用していることがあるため、都市ごとの公共測量作業規程を確認する必要がある。

**表 S-10 — 地形に該当する公共測量標準図式の分類コード**

| 分類コード | 名称 | 対応するクラス |
| --- | --- | --- |
| 7101 | 等高線（計曲線） | dem::BreaklineRelief |
| 7102 | 等高線（主曲線） | dem::BreaklineRelief |
| 7103 | 等高線（補助曲線） | dem::BreaklineRelief |
| 7105 | 凹地（計曲線） | dem::BreaklineRelief |
| 7106 | 凹地（主曲線） | dem::BreaklineRelief |
| 7107 | 凹地（補助曲線） | dem::BreaklineRelief |
| 7199 | 凹地（矢印） | dem::BreaklineRelief |
| 7201 | 土がけ（崩土） | dem::BreaklineRelief |
| 7202 | 雨裂 | dem::BreaklineRelief |
| 7206 | 洞口 | dem::BreaklineRelief |
| 7211 | 岩がけ | dem::BreaklineRelief |
| 7212 | 露岩 | dem::BreaklineRelief |
| 7213 | 散岩 | dem::BreaklineRelief （線で取得する場合） |
| ↑ | ↑ | dem::MassPointRelief（点で取得する場合） |
| 7214 | さんご礁 | dem::BreaklineRelief |
| 7311 | 標石を有しない標高点 | dem::MassPointRelief |
| 7312 | 図化機測定による標高点 | dem::MassPointRelief |

## S.3.1.2 LOD1

## S.3.1.2.1 地形モデル（LOD1）の原典資料

**表 S-11**

|  | 高さを含む座標データ |
| --- | --- |
| LOD1 | 以下のいずれかのデータを一つ以上使用する基盤地図情報（標高モデル）航空写真航空レーザ点群 |

## S.3.1.2.2 地形モデル（LOD1）の作成手順（dem:TINRelief）

- 原典資料を入手する。
地形モデル（LOD1）は、基盤地図情報（標高モデル）からのデータ変換により作成することを基本とする。 
ただし、基盤地図情報（標高モデル）の作成時期よりも新しい航空レーザ点群がある場合には、この航空レーザ点群を使用できる。既存の都市オブジェクトがある場合には、その都市オブジェクトの底面の高さは既存の地形モデルに依存しているため、新しい航空レーザ点群で作成される地形モデルと整合しない（既存の都市オブジェクトが、新しい航空レーザから作成された地形モデルから浮かんだり、沈んだりする）場合があることに留意する
また、水部以外で基盤地図情報（標高モデル）や航空レーザ点群のデータがない場合は、航空写真の三次元図化で取得したブレークライン（傾斜が急激に変化する地点で高さを取得し、この地点をつないで作成した折れ線）を用いて欠落している範囲の標高モデル（DEM）を作成し、既存データと合成する。
- a）で入手又は作成したデータからTINを作成する。
 DEMからTINを作成する。ただし、水部ではTINを作成しない。 
基盤地図情報（標高モデル）から作成する場合、欠落部の標高値に-9999が設定されているため、その点群を除去しTINを作成する。航空写真から作成する場合は、水涯線を図化し水涯線までのTINを作成し、航空レーザ点群から作成する場合は、水部ポリゴンデータ（作業規程の準則の第554条に定める、航空レーザ用写真地図データを用いて水部の範囲を対象に作成したポリゴンデータ）までのTINを作成する。

## S.3.1.2.3 地形モデル（LOD1）の作成手順（dem:MassPointRelief）

- 原典資料を入手する。
地形モデル（LOD1）は、基盤地図情報（標高モデル）からのデータ変換により作成することを基本とする。 
ただし、基盤地図情報（標高モデル）の作成時期よりも新しい航空レーザ点群がある場合は、この航空レーザ点群を使用できる。既存の都市オブジェクトがある場合には、その都市オブジェクトの底面の高さは既存の地形モデルに依存しているため、新しい航空レーザ点群で作成される地形モデルと整合しない（既存の都市オブジェクトが、新しい航空レーザから作成された地形モデルから浮かんだり、沈んだりする）場合があることに留意する。 
また、水部以外で基盤地図情報（標高モデル）や航空レーザ点群のデータがない場所は、航空写真の三次元図化で取得したブレークライン（傾斜が急激に変化する地点で高さを取得し、この地点をつないで作成した折れ線）を用いて欠落した範囲のDEMを作成し、既存データと合成する。
- 地形の外形を多角形で取得する。
ランダム点群の場合、点の集合から地形モデルの範囲を正確に取得できない。そのため地形の外側の境界（dem:extentのexterior）を必ず作成する。地形の内空の境界（dem:extentのinterior）は任意で取得する。

## S.3.1.3 LOD2

## S.3.1.3.1 地形モデル（LOD2）の原典資料

**表 S-12**

|  | 高さを含む座標データ |
| --- | --- |
| LOD2 | 以下のいずれかのデータを一つ以上使用する航空写真航空レーザ点群 |

## S.3.1.3.2 地形モデル（LOD2）の作成手順（dem:TINRelief）

- 航空写真から作成した点群や航空レーザ点群を用いて、TINを作成する。点群からTINを作成する。ただし、水部ではTINを作成しない。航空写真から作成する場合は、水涯線を図化し水涯線までのTINを作成し、航空レーザ点群から作成する場合は、水部ポリゴンまでのTINを作成する。

## S.3.1.3.3 地形モデル（LOD2）の作成手順（dem:MassPointRelief）

- 航空写真から作成した点群や航空写真レーザ点群をデータ変換しdem:MassPointReliefを作成する。
- 地形の外形を多角形で取得する。

ランダム点群の場合、点の集合から地形モデルの範囲を正確に取得できない。そのため地形の外側の境界（dem:extentのexterior）を必ず作成する。地形の内空の境界（dem:extentのinterior）は任意で取得する。

## S.3.1.4 LOD3

## S.3.1.4.1 地形モデル（LOD3）の原典資料

**表 S-13**

|  | 高さを含む座標データ |
| --- | --- |
| LOD3 | 以下のいずれかのデータを一つ以上使用する航空写真航空レーザ点群MMS点群地上レーザ点群 |

## S.3.1.4.2 地形モデル（LOD3）の作成手順

地形モデル（LOD2）の作成手順と同様となる。

## S.3.2 作業上の留意事項

## S.3.2.1 微小ポリゴンについて

3D都市モデルでは、地形モデルは基準地域メッシュ（第三次地域区画、一辺の長さ約1km）を地物の単位とする。

原典資料における地物の単位と異なる場合には、データ変換時に微小ポリゴンが生成される可能性がある。そのため、論理一貫性における位相一貫性の検査（頂点間での距離が近接閾値未満の頂点の検出）を行い、閾値未満の頂点が検出された場合には頂点を統合する処理を行う。

## S.3.2.2 TINの作成

TINの作成はソフトウェアによって、欠落部（河川等）の対岸までTINを生成する場合がある。その場合、生成されたTINから不要な辺を削除する必要がある。

不要な辺は、TINの三角形を構成する辺の正射影の長さが格子の斜辺の長さの最大値よりも長い辺を抽出することで特定できる。

![Image](images/tocS_img002.png)

## S.3.2.3 高密度点群データによる地形の表現

標準製品仕様書では、地形モデル（LOD1）から地形モデル（LOD3）までは、地形の作成に使用する原典資料の点密度又は標高点格子間隔により決定することとしている。原典資料として高密度点群データを使用する場合も、地形モデルのLOD定義に従った点密度に加工し、地形モデルを作成しなければならない。

そのうえで、原典資料と同様の高密度点群データを3D都市モデルに含めたい場合には、dem:MassPointReliefを使用し、地形モデルとして記述することができる。

## S.3.2.4 ファイルの分割

3D都市モデルでは、一つの地物インスタンスに異なるLODの幾何オブジェクトを含めることで、同一の都市オブジェクトをマルチスケールで表現することが可能である。しかしながら、地形モデルの場合はインスタンスの単位が基準地域メッシュとなるため、一つの地物インスタンスに複数のLODの幾何オブジェクトを含めることでデータ量が膨大となり、操作性が低下する懸念がある。

そこで、地形モデルの中で最も詳細な地形表現が可能となる地形モデル（LOD3）は、ファイルを分けることを許容する。このとき、ファイル名にはオプションの文字列として、lod3を使用する。

なお、分割されたファイルに含まれるそれぞれの地物インスタンスのgml:nameには同じ基準地域メッシュのメッシュ番号が記載されるため、必要に応じて利用者側で一つの地物インスタンスに統合することが可能である。

