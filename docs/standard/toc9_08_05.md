# 9.8.5 繰り返しオブジェクト（Implicit Geometry）

## 9.8.5 繰り返しオブジェクト（Implicit Geometry）

繰り返しオブジェクト（ImplicitGeometry）は、地物毎に幾何オブジェクトを作成する代替として、一つのプロトタイプモデルを作成し、そのプロトタイプモデルを複数の地物が参照する仕組みである。CityGMLでは、都市設備、単独木など、特定の地物型のみこの仕組みを使用できる。

地物毎に、どのプロトタイプモデルを使用するのか、どこに配置するのか、また、プロトタイプモデルをどう変形するのかを情報としてもつことができる。

標準製品仕様書では、埋設物モデル（LOD2）、埋設物モデル（LOD3）、埋設物モデル（LOD4）のみ繰り返しオブジェクトを使用することを可とする。

![Image](images/toc9_08_05_img001.png)

## 9.8.5.1 core:ImplicitGeometry

**表 9-11**

| 型の定義 | 繰り返しオブジェクト。 地物毎に幾何オブジェクトを作成する代替として、一つのプロトタイプモデルを複数の地物が参照する仕組み。 | ← |
| --- | --- | --- |
| 上位の型 | — | ← |
| ステレオタイプ | << Type >> | ← |
| 自身に定義された属性 | ← | ← |
| 属性名 | 属性の型及び多重度 | 定義 |
| core:libraryObject     [ ImplicitGeometry ] | xs::anyURI [0..1] | 繰り返しオブジェクトで使用するプロトタイプモデルの所在を示すURI。 この属性が記述されていない場合、core:relativeGMLGeometryを必須とする。 |
| core:mimeType     [ ImplicitGeometry ] | gml::CodeType [0..1] | 繰り返しオブジェクトで使用するプロトタイプモデルのファイル種類。コードリスト（ImplicitGeometry_mimeType.xml）より選択する。 |
| core:transformationMatrix     [ ImplicitGeometry ] | TransformationMatrix4x4 [0..1] | 繰り返しオブジェクトで使用するプロトタイプモデルの変形パラメータ。 |
| 自身に定義された関連役割 | ← | ← |
| 関連役割名 | 関連役割の型及び多重度 | 定義 |
| core:referencePoint             [ ImplicitGeometry ] | gml:Point [1..1] | 繰り返しオブジェクトの原点（0,0,0）を配置する参照点。3D都市モデルに適用される測地座標で記述する。 |
| core:relativeGMLGeometry             [ ImplicitGeometry ] | gml:_Geometry [0..1] | 繰り返しオブジェクトで使用するプロトタイプモデル。GML形式で記述する場合に必須とする。 この関連役割が記述されていない場合、core:libraryObjectを必須とする。 |

## 9.8.5.2 core:TransformationMatrix4x4

**表 9-12**

| 型の定義 | 繰り返しオブジェクトで使用するプロトタイプモデルを変形（拡大縮小、回転、平行移動）するための、3次元座標のアフィン変換行列。4×4の行列を示す16桁の数値の列からなる。 | ← |
| --- | --- | --- |
| 上位の型 | — | ← |
| ステレオタイプ | << dataType >> | ← |
| 自身に定義された属性 | ← | ← |
| 属性名 | 属性の型及び多重度 | 定義 |
| core:elements     [ TransformationMatrix4x4 ] | xs::double [16..16] | 16桁の実数の列。順序をもつ。 16桁は4×4の変換行列を示し、最初の4桁は1行目、次の4桁は2行目、次の4桁は3行目、最後の4桁は4行目となる。 |

## 9.8.5.3 ImplicitGeometry_mimeType.xml

**表 9-13**

| ファイル名 | ImplicitGeometry_mimeType.xml |
| --- | --- |
| ファイルURL | [https://www.geospatial.jp/iur/codelists/3.2/ImplicitGeometry_mimeType.xml](https://www.geospatial.jp/iur/codelists/3.2/ImplicitGeometry_mimeType.xml) |
| コード | 説明 |
| model/gltf+json | .gltf |
| model/x3d+xml | .x3db, .x3d |
| model/x3+vrml | .x3dv, .x3dvz |
| model/obj | .obj |

## 9.8.5.4 ImplicitGeometryにより地下埋設物の形状を表現する場合の関連役割

地下埋設物の形状を、ImplicitGeometryにより表現する場合、frn:CityFurnitureから継承する関連役割を使用する。

**表 9-14**

| 継承する関連役割 | ← | ← |
| --- | --- | --- |
| 関連役割名 | 関連役割の型及び多重度 | 定義 |
| frn:lod2ImplicitRepresentation | core:ImplicitGeometry [0..1] | LOD2の幾何オブジェクトの代替として使用する繰り返しオブジェクト。 |
| frn:lod3ImplicitRepresentation | core:ImplicitGeometry [0..1] | LOD3の幾何オブジェクトの代替として使用する繰り返しオブジェクト。 |
| frn:lod4ImplicitRepresentation | core:ImplicitGeometry [0..1] | LOD4の幾何オブジェクトの代替として使用する繰り返しオブジェクト。 |

